import{h as g,d as i,_ as w,W as n,V as b,m as l,$ as y,a0 as S,X as h,a4 as x,a3 as U}from"./vue-DQIp4sjX.js";import{a4 as k,e as C}from"./index-I9y5uwlj.js";import{R as f}from"./request-B22OhU3A.js";import{V as N}from"./VSheet-BgOyCOrm.js";import{V as R}from"./VForm-DAuIbUed.js";import{V as c}from"./VTextField-CioUwnLL.js";import{V as q}from"./VCard-Qx0q1Gfz.js";import"./vuetify-BfLt-5w1.js";class B{login(a){return f.post("/auth/login",{username:a.username,password:a.password})}logout(){localStorage.removeItem("user")}register(a){return f.post("/auth/register",{username:a.username,password:a.password})}}const _=new B;function A(u){if(u==null)return null;var a=u.split(".")[1],o=a.replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(window.atob(o).split("").map(function(d){return"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(t)}const M=g({__name:"login",setup(u){const a=i(!1),o=i({username:"",password:""}),t=i(!1),d=x(),V=U(),m=k();function p(r){return!!r||"Field is required"}function v(){_.login(o.value).then(r=>{if(r.code!=0)alert("登录失败: "+r.message);else{m.setToken(r.result.token);const e=A(r.result.token);m.setUserName(e.sub);const s=d.query.redirect||"/admin/home";V.push(s)}})}return(r,e)=>(b(),w(N,{class:"bg-deep-dark pa-12",rounded:""},{default:n(()=>[l(q,{class:"mx-auto px-6 py-8","max-width":"344"},{default:n(()=>[l(R,{modelValue:a.value,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value=s),onSubmit:y(v,["prevent"])},{default:n(()=>[l(c,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.username=s),readonly:t.value,rules:[p],class:"mb-2",label:"Username/Email",focused:""},null,8,["modelValue","readonly","rules"]),l(c,{type:"password",modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.password=s),readonly:t.value,rules:[p],label:"Password",placeholder:"Enter your password"},null,8,["modelValue","readonly","rules"]),e[4]||(e[4]=S("br",null,null,-1)),l(C,{disabled:!a.value,loading:t.value,block:"",color:"primary",size:"large",type:"submit",variant:"elevated"},{default:n(()=>[...e[3]||(e[3]=[h(" Sign In ",-1)])]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{M as default};
