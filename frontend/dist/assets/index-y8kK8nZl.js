import{S as C}from"./signs-DhIujT0K.js";import{h as z,d as n,x as E,_ as D,V,W as l,m as e,X as r,U as A,a0 as h,a6 as K,Y as S,a3 as M,a4 as P}from"./vue-DQIp4sjX.js";import{Q as W}from"./query-configs-BXGaxLXg.js";import{V as _,b as N,a as w,c as j}from"./VCard-Qx0q1Gfz.js";import{y as X,e as v,i as Y,f as G,_ as J}from"./index-I9y5uwlj.js";import{V as F}from"./VTextField-CioUwnLL.js";import{V as L}from"./VAlert-BiI7SsRB.js";import{d as H,c as k,V as O,a as Z,b as B,g as ee}from"./VDataTable-DvIcUScc.js";import{V as U}from"./VDialog-DsLKFviM.js";import"./request-B22OhU3A.js";import"./vuetify-BfLt-5w1.js";import"./VSelectionControl-HCumd4nr.js";const le={key:0,class:"d-flex justify-center my-5"},ae={key:1},te={class:"mb-4 d-flex align-center"},oe=["title"],se=z({__name:"QueryConfigSign",props:{appId:{}},setup(T){const x=T,y=n([]),g=n(""),u=n(!1),d=n(!1),f=n(""),c=n([]),p=n([]),b=n([{title:"selectId",key:"selectId",width:"15%"},{title:"描述",key:"note",width:"55%"}]);function Q(i){u.value=!0;try{C.getSignQueryRelations(i).then(t=>{console.log("res",t),y.value=t,I()})}catch(t){f.value=`加载数据失败: ${t.message}`,console.error("Error loading query configs:",t)}finally{}}function I(){if(y.value.length&&c.value.length){const i=y.value.map(t=>t.selectId);p.value=c.value.filter(t=>i.includes(t.selectId)),console.log("已自动选择匹配的查询配置",p.value)}}const $=async()=>{d.value=!0,f.value="";try{const i=p.value.map(t=>t.selectId);console.log("queryConfigIds",i),await C.updateSignQueryRelations(x.appId,i),alert("关联关系已更新")}catch(i){f.value=`保存失败: ${i.message}`,console.error("Error saving query config relations:",i)}finally{d.value=!1}};return E(()=>{Q(x.appId),W.list().then(i=>{c.value=i,I()}).finally(()=>{u.value=!1})}),(i,t)=>(V(),D(_,null,{default:l(()=>[e(N,null,{default:l(()=>[...t[2]||(t[2]=[r("关联查询配置",-1)])]),_:1}),e(w,null,{default:l(()=>[u.value?(V(),A("div",le,[e(X,{indeterminate:"",color:"primary"})])):(V(),A("div",ae,[h("div",te,[e(F,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=m=>g.value=m),label:"搜索查询配置",density:"compact","hide-details":"",variant:"outlined",clearable:"","prepend-inner-icon":"mdi-magnify",class:"mb-2"},null,8,["modelValue"])]),f.value?(V(),D(L,{key:0,type:"error",density:"compact",variant:"tonal",class:"mb-3"},{default:l(()=>[r(S(f.value),1)]),_:1})):K("",!0),e(H,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=m=>p.value=m),headers:b.value,items:c.value,search:g.value,"item-value":"selectId",density:"compact",class:"elevation-1","show-select":"","return-object":""},{"item.note":l(({item:m})=>[h("div",{class:"text-truncate",style:{"max-width":"200px"},title:m.note},S(m.note),9,oe)]),_:1},8,["modelValue","headers","items","search"])]))]),_:1}),e(j,null,{default:l(()=>[e(k),e(v,{color:"secondary",variant:"text"},{default:l(()=>[...t[3]||(t[3]=[r(" 取消 ",-1)])]),_:1}),e(v,{color:"primary",variant:"text",onClick:$,loading:d.value,disabled:u.value||d.value},{default:l(()=>[...t[4]||(t[4]=[r(" 保存 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1}))}}),ne={class:"d-flex justify-center gap-2"},ie=z({__name:"index",setup(T){const x=M(),y=P(),g=n(""),u=n([]),d=n(!1),f=n(!1),c=n(""),p=n(!1),b=n(""),Q=n([{title:"App Id",value:"appId",width:"20%"},{title:"App Secret",value:"appKey",width:"30%"},{title:"申请人",value:"applier",width:"20%"},{title:"是否启用",value:"enabled",width:"15%"},{title:"操作",value:"actions",sortable:!1,width:"15%",align:"center"}]),I=()=>{x.push(`${y.name?.toString()}/new`.replace(/\/+/g,"/"))},$=s=>{c.value=s,f.value=!0},i=()=>{c.value&&(d.value=!0,C.remove(c.value).then(()=>{u.value=u.value.filter(s=>s.appId!==c.value),alert("删除成功")}).catch(s=>{alert(`删除失败: ${s.message}`)}).finally(()=>{d.value=!1,f.value=!1,c.value=""}))},t=s=>{const a=u.value.find(o=>o.appId===s);a&&(a.enabled=!a.enabled,d.value=!0,C.update(a.appId,a).then(()=>{u.value=u.value.map(o=>o.appId===s?a:o)}).catch(o=>{alert(`更新失败: ${o.message}`)}).finally(()=>{d.value=!1}))},m=async s=>{b.value=s,p.value=!0},q=()=>{p.value=!1};return E(()=>{d.value=!0,C.list().then(s=>{u.value=s}).catch(s=>{console.error("Error fetching signs:",s),alert(`加载签名失败: ${s.message}`)}).finally(()=>{d.value=!1})}),(s,a)=>(V(),D(O,{fluid:"",class:"pa-4"},{default:l(()=>[e(_,{flat:"",class:"mb-6"},{default:l(()=>[e(w,null,{default:l(()=>[e(Z,{dense:"",align:"center",class:"mb-2"},{default:l(()=>[e(B,{cols:"auto"},{default:l(()=>[e(Y,{class:"text-h5 font-weight-bold"},{default:l(()=>[...a[4]||(a[4]=[r("签名",-1)])]),_:1})]),_:1}),e(k),e(B,{cols:"auto"},{default:l(()=>[e(v,{size:"small",color:"primary",variant:"outlined","prepend-icon":"mdi-plus",onClick:I},{default:l(()=>[...a[5]||(a[5]=[r(" 新增 ",-1)])]),_:1})]),_:1})]),_:1}),a[6]||(a[6]=h("div",{class:"text-body-2 text-medium-emphasis mb-4 w-100 w-md-75"}," 以下为当前的签名列表，您可以查看、编辑、启用/禁用或删除签名。 ",-1))]),_:1})]),_:1}),e(_,{flat:""},{default:l(()=>[e(w,null,{default:l(()=>[e(H,{headers:Q.value,items:u.value,search:g.value,density:"compact",class:"elevation-1","items-per-page":10,loading:d.value},{top:l(()=>[e(G,{density:"compact",class:"mb-2"},{default:l(()=>[e(k),e(F,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=o=>g.value=o),label:"搜索",density:"compact","single-line":"","hide-details":"",variant:"outlined",clearable:"","prepend-inner-icon":"mdi-magnify",style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1})]),"item.enabled":l(({item:o})=>[e(ee,{color:o.enabled?"success":"error","text-color":"white",size:"small"},{default:l(()=>[r(S(o.enabled?"已启用":"已禁用"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:o})=>[h("div",ne,[e(v,{size:"small",color:"error",variant:"text",onClick:R=>$(o.appId)},{default:l(()=>[...a[7]||(a[7]=[r(" 删除 ",-1)])]),_:1},8,["onClick"]),e(v,{size:"small",color:"primary",variant:"text",onClick:R=>t(o.appId)},{default:l(()=>[r(S(o.enabled?"禁用":"启用"),1)]),_:2},1032,["onClick"]),e(v,{size:"small",color:"info",variant:"text",onClick:R=>m(o.appId)},{default:l(()=>[...a[8]||(a[8]=[r(" 关联查询 ",-1)])]),_:1},8,["onClick"])])]),_:1},8,["headers","items","search","loading"])]),_:1})]),_:1}),e(U,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=o=>f.value=o),"max-width":"400"},{default:l(()=>[e(_,null,{default:l(()=>[e(N,null,{default:l(()=>[...a[9]||(a[9]=[r("确认删除",-1)])]),_:1}),e(w,null,{default:l(()=>[...a[10]||(a[10]=[r("确定要删除此签名吗？",-1)])]),_:1}),e(j,null,{default:l(()=>[e(k),e(v,{color:"secondary",variant:"text",onClick:a[1]||(a[1]=o=>f.value=!1)},{default:l(()=>[...a[11]||(a[11]=[r(" 取消 ",-1)])]),_:1}),e(v,{color:"primary",variant:"text",onClick:i},{default:l(()=>[...a[12]||(a[12]=[r(" 确认 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(U,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=o=>p.value=o),"max-width":"700"},{default:l(()=>[e(se,{appId:b.value,onClose:q,onSave:q},null,8,["appId"])]),_:1},8,["modelValue"])]),_:1}))}}),xe=J(ie,[["__scopeId","data-v-daa6ce25"]]);export{xe as default};
