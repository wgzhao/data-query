import{t as te,a as V,J as v,m as a,n as w,F as _,p as ae,d as g,h as se,_ as oe,W as l,V as le,a0 as T,X as k,a1 as re,a8 as ne}from"./vue-DQIp4sjX.js";import{R as E}from"./request-B22OhU3A.js";import{i as de,j as ie,k as ue,l as ce,u as me,p as pe,n as ge,o as ve,q as fe,r as he,s as ye,t as be,v as I,w as B,x as C,h as R,y as xe,z as Pe,A as Ve,V as we,a as Te,b as Se,c as De}from"./VDataTable-DvIcUScc.js";import{a as q,V as F}from"./VCard-Qx0q1Gfz.js";import{x as _e,i as ke,f as Ie}from"./index-I9y5uwlj.js";import{g as Be,p as Ce,h as Re,u as qe}from"./vuetify-BfLt-5w1.js";import{V as Fe}from"./VAlert-BiI7SsRB.js";import{V as Ke}from"./VTextField-CioUwnLL.js";import"./VSelectionControl-HCumd4nr.js";const Ee=Ce({itemsLength:{type:[Number,String],required:!0},...Ve(),...Pe(),...xe()},"VDataTableServer"),Ge=Be()({name:"VDataTableServer",props:Ee(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,p){let{attrs:c,slots:t}=p;const{groupBy:r}=de(e),{sortBy:n,multiSort:y,mustSort:b}=ie(e),{page:f,itemsPerPage:h}=ue(e),{disableSort:x}=te(e),d=V(()=>parseInt(e.itemsLength,10)),{columns:s,headers:m}=ce(e,{groupBy:r,showSelect:v(e,"showSelect"),showExpand:v(e,"showExpand")}),{items:o}=me(e,s),{toggleSort:i}=pe({sortBy:n,multiSort:y,mustSort:b,page:f}),{opened:L,isGroupOpen:N,toggleGroup:O,extractRows:j}=ge({groupBy:r,sortBy:n,disableSort:x}),{pageCount:A,setItemsPerPage:H}=ve({page:f,itemsPerPage:h,itemsLength:d}),{flatItems:S}=fe(o,r,L),{isSelected:z,select:U,selectAll:$,toggleSelect:Q,someSelected:W,allSelected:J}=he(e,{allItems:o,currentPage:o}),{isExpanded:X,toggleExpand:M}=ye(e),D=V(()=>j(o.value));be({page:f,itemsPerPage:h,sortBy:n,groupBy:r,search:v(e,"search")}),ae("v-data-table",{toggleSort:i,sortBy:n}),Re({VDataTableRows:{hideNoData:v(e,"hideNoData"),noDataText:v(e,"noDataText"),loading:v(e,"loading"),loadingText:v(e,"loadingText")}});const u=V(()=>({page:f.value,itemsPerPage:h.value,sortBy:n.value,pageCount:A.value,toggleSort:i,setItemsPerPage:H,someSelected:W.value,allSelected:J.value,isSelected:z,select:U,selectAll:$,toggleSelect:Q,isExpanded:X,toggleExpand:M,isGroupOpen:N,toggleGroup:O,items:D.value.map(P=>P.raw),internalItems:D.value,groupedItems:S.value,columns:s.value,headers:m.value}));qe(()=>{const P=I.filterProps(e),Y=B.filterProps(e),Z=C.filterProps(e),ee=R.filterProps(e);return a(R,w({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ee),{top:()=>t.top?.(u.value),default:()=>t.default?t.default(u.value):a(_,null,[t.colgroup?.(u.value),!e.hideDefaultHeader&&a("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[a(B,w(Y,{sticky:e.fixedHeader}),t)]),t.thead?.(u.value),!e.hideDefaultBody&&a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[t["body.prepend"]?.(u.value),t.body?t.body(u.value):a(C,w(c,Z,{items:S.value}),t),t["body.append"]?.(u.value)]),t.tbody?.(u.value),t.tfoot?.(u.value)]),bottom:()=>t.bottom?t.bottom(u.value):!e.hideDefaultFooter&&a(_,null,[a(_e,null,null),a(I,P,{prepend:t["footer.prepend"]})])})})}}),G=g("/query-logs"),Le=(e,p,c)=>{const t={page:e,size:p,sortKey:c.sortKey,sortOrder:c.sortOrder};return E.get(`${G.value}`,t)},Ne=(e,p,c,t)=>{const r={q:e,page:p,size:c,sortKey:t.sortKey,sortOrder:t.sortOrder};return E.get(`${G.value}/search`,r)},K={list:Le,search:Ne},Oe=["colspan"],Xe=se({__name:"index",setup(e){const p=g([]),c=g(10),t=g(10),r=g(!1),n=g(""),y=g([]),b=g([{title:"编号",key:"id",width:"15%"},{title:"应用ID",key:"appId",width:"20%"},{title:"查询ID",key:"selectId",width:"20%"},{title:"查询时间",key:"createdAt",width:"25%"},{title:"查询SQL",key:"data-table-expand",sortable:!1,width:"20%"}]),f=d=>{let s=[],m=[];if(d.length)for(let o=0;o<d.length;o++)s.push(d[o].key),m.push(d[o].order);else s.push("createdAt"),m.push("desc");return{sortKey:s.join(),sortOrder:m.join()}},h=async({page:d,itemsPerPage:s,sortBy:m})=>{r.value=!0;const o=f(m);try{const i=n.value?await K.search(n.value,d-1,s,o):await K.list(d-1,s,o);p.value=i.content,c.value=i.totalElements}catch(i){console.error("Error loading logs:",i),alert(`加载日志失败: ${i.message}`)}finally{r.value=!1}},x=()=>{h({page:1,itemsPerPage:t.value,sortBy:[]})};return(d,s)=>{const m=re("highlightjs");return le(),oe(we,{fluid:"",class:"pa-4"},{default:l(()=>[a(F,{flat:"",class:"mb-6"},{default:l(()=>[a(q,null,{default:l(()=>[a(Te,{dense:"",align:"center",class:"mb-2"},{default:l(()=>[a(Se,{cols:"auto"},{default:l(()=>[a(ke,{class:"text-h5 font-weight-bold"},{default:l(()=>[...s[2]||(s[2]=[k("查询日志",-1)])]),_:1})]),_:1})]),_:1}),s[3]||(s[3]=T("div",{class:"text-body-2 text-medium-emphasis mb-4 w-100 w-md-75"}," 以下为当前的查询日志列表，您可以查看或搜索日志详情。 ",-1))]),_:1})]),_:1}),a(F,{flat:""},{default:l(()=>[a(q,null,{default:l(()=>[a(Ge,{"items-per-page":t.value,"onUpdate:itemsPerPage":s[1]||(s[1]=o=>t.value=o),headers:b.value,"items-length":c.value,items:p.value,loading:r.value,"item-value":"id",density:"compact",class:"elevation-1","onUpdate:options":h,expanded:y.value,"show-expand":""},{top:l(()=>[a(Ie,{density:"compact",class:"mb-2"},{default:l(()=>[a(De),a(Ke,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=o=>n.value=o),label:"搜索",density:"compact","single-line":"","hide-details":"",variant:"outlined",clearable:"","prepend-inner-icon":"mdi-magnify",style:{"max-width":"300px"},onKeyup:ne(x,["enter"])},null,8,["modelValue"])]),_:1})]),"expanded-row":l(({columns:o,item:i})=>[T("tr",null,[T("td",{colspan:o.length,class:"pa-4"},[a(m,{language:"sql",code:i.querySql},null,8,["code"])],8,Oe)])]),"no-data":l(()=>[a(Fe,{type:"info",class:"mt-2"},{default:l(()=>[...s[4]||(s[4]=[k("暂无查询日志数据",-1)])]),_:1})]),_:1},8,["items-per-page","headers","items-length","items","loading","expanded"])]),_:1})]),_:1})]),_:1})}}});export{Xe as default};
