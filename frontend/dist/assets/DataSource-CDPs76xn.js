import{d as c,s as L,f as K,b as Q,w as N,x as z,a as E,m as t,n as R,o as Z,A as ee,h as J,_ as F,V as D,W as u,X as q,Y,U as A,$ as ae,a0 as I,a6 as te}from"./vue-DQIp4sjX.js";import{D as O}from"./data-sources-BUU_4ipN.js";import{j as le,k as se,l as oe,n as ne,o as $,h as re,p as ie,q as ue,r as ce,s as de,t as ve,v as me,w as fe,d as ye,e as U,_ as be}from"./index-I9y5uwlj.js";import{g as Ve,p as pe,z as ke,v as we,A as ge,am as Se,ap as Ce,u as Te,X as xe,x as he,aq as De}from"./vuetify-BfLt-5w1.js";import{V as Pe,a as M,b as B,f as qe}from"./VDataTable-DvIcUScc.js";import{V as je,a as Oe}from"./VCard-Qx0q1Gfz.js";import{V as Ue}from"./VForm-DAuIbUed.js";import{V as h}from"./VTextField-CioUwnLL.js";function Be(e){const d=L(e());let n=-1;function o(){clearInterval(n)}function w(){o(),ee(()=>d.value=e())}function l(f){const b=f?getComputedStyle(f):{transitionDuration:.2},y=parseFloat(b.transitionDuration)*1e3||200;if(o(),d.value<=0)return;const V=performance.now();n=window.setInterval(()=>{const g=performance.now()-V+y;d.value=Math.max(e()-g,0),d.value<=0&&o()},y)}return Z(o),{clear:o,time:d,start:l,reset:w}}const Le=pe({multiLine:Boolean,text:String,timer:[Boolean,String],timeout:{type:[Number,String],default:5e3},vertical:Boolean,...de({location:"bottom"}),...ce(),...ue(),...ie(),...he(),...xe(ve({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},"VSnackbar"),Ne=Ve()({name:"VSnackbar",props:Le(),emits:{"update:modelValue":e=>!0},setup(e,d){let{slots:n}=d;const o=ke(e,"modelValue"),{positionClasses:w}=le(e),{scopeId:l}=se(),{themeClasses:f}=we(e),{colorClasses:b,colorStyles:y,variantClasses:V}=oe(e),{roundedClasses:g}=ne(e),p=Be(()=>Number(e.timeout)),P=c(),v=c(),k=L(!1),m=L(0),S=c(),j=K(De,void 0);ge(()=>!!j,()=>{const i=Se();Q(()=>{S.value=i.mainStyles.value})}),N(o,C),N(()=>e.timeout,C),z(()=>{o.value&&C()});let T=-1;function C(){p.reset(),window.clearTimeout(T);const i=Number(e.timeout);if(!o.value||i===-1)return;const x=Ce(v.value);p.start(x),T=window.setTimeout(()=>{o.value=!1},i)}function s(){p.reset(),window.clearTimeout(T)}function a(){k.value=!0,s()}function r(){k.value=!1,C()}function H(i){m.value=i.touches[0].clientY}function W(i){Math.abs(m.value-i.changedTouches[0].clientY)>50&&(o.value=!1)}function X(){k.value&&r()}const _=E(()=>e.location.split(" ").reduce((i,x)=>(i[`v-snackbar--${x}`]=!0,i),{}));return Te(()=>{const i=$.filterProps(e),x=!!(n.default||n.text||e.text);return t($,R({ref:P,class:["v-snackbar",{"v-snackbar--active":o.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--timer":!!e.timer,"v-snackbar--vertical":e.vertical},_.value,w.value,e.class],style:[S.value,e.style]},i,{modelValue:o.value,"onUpdate:modelValue":G=>o.value=G,contentProps:R({class:["v-snackbar__wrapper",f.value,b.value,g.value,V.value],style:[y.value],onPointerenter:a,onPointerleave:r},i.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0,onTouchstartPassive:H,onTouchend:W,onAfterLeave:X},l),{default:()=>[me(!1,"v-snackbar"),e.timer&&!k.value&&t("div",{key:"timer",class:"v-snackbar__timer"},[t(fe,{ref:v,color:typeof e.timer=="string"?e.timer:"info",max:e.timeout,"model-value":p.time.value},null)]),x&&t("div",{key:"content",class:"v-snackbar__content",role:"status","aria-live":"polite"},[n.text?.()??e.text,n.default?.()]),n.actions&&t(ye,{defaults:{VBtn:{variant:"text",ripple:!1,slim:!0}}},{default:()=>[t("div",{class:"v-snackbar__actions"},[n.actions({isActive:o})])]})],activator:n.activator})}),re({},P)}}),Fe=J({__name:"ToastInfo",props:{toast:{}},setup(e){return(d,n)=>(D(),F(Ne,{modelValue:e.toast.showToast,"onUpdate:modelValue":n[0]||(n[0]=o=>e.toast.showToast=o),"multi-line":"",vertical:"",location:"top",color:e.toast.color},{default:u(()=>[q(Y(e.toast.msg),1)]),_:1},8,["modelValue","color"]))}}),Re={class:"d-flex justify-space-between align-center"},Ae={key:1},Ie={class:"d-flex gap-3"},$e=J({__name:"DataSource",props:{dataSource:{type:Object,default:null},viewOnly:{type:Boolean,default:!1}},emits:["saved","cancel"],setup(e,{emit:d}){const n=e,o=d,w={no:"",name:"",url:"",username:"",password:"",driver:"com.mysql.cj.jdbc.Driver"},l=c({...w}),f=c(),b=c(!1),y=c(!1),V=c(!1),g=c(null),p=E(()=>!!n.dataSource),P=c(["com.mysql.jdbc.Driver","com.mysql.cj.jdbc.Driver","org.postgresql.Driver","oracle.jdbc.OracleDriver","io.trino.jdbc.TrinoDriver","com.clickhouse.jdbc.ClickHouseDriver","io.prestosql.jdbc.PrestoDriver","com.microsoft.sqlserver.jdbc.SQLServerDriver","org.apache.hive.jdbc.Hive2Driver"]),v=c({required:s=>!!s||"Field is required",validJdbcUrl:s=>s.startsWith("jdbc:")||"URL must start with jdbc:",checkNo:async s=>s?!p.value&&await O.exists(s)?"编号已存在":!0:"Field is required"}),k=c({showToast:!1,msg:"",color:""}),m=(s,a=!0)=>{k.value={color:a?"error":"success",showToast:!0,msg:s}},S=c(!1),j=async()=>{if(!l.value.url){m("JDBC 地址不能为空",!0);return}S.value=!0;try{const s=await O.testConnection(l.value);s.code!==200?(f.value="mdi-close",m(s.message,!0)):(f.value="mdi-check",m("连接成功",!1))}catch(s){f.value="mdi-close",m(`连接失败: ${s.message}`,!0)}finally{S.value=!1}},T=async()=>{if(!g.value?.validate()){m("请检查输入",!0);return}V.value=!0;try{O.save(l.value).then(s=>{m("保存成功！",!1),setTimeout(()=>{o("saved")},1e3)})}catch(s){m(`保存失败: ${s.message}`,!0)}finally{V.value=!1}},C=()=>{o("cancel")};return N(()=>n.dataSource,s=>{s?l.value={...s}:l.value={...w}},{immediate:!0}),z(()=>{n.dataSource&&(l.value={...n.dataSource})}),(s,a)=>(D(),A("div",null,[t(Fe,{toast:k.value},null,8,["toast"]),t(Pe,{fluid:"",class:"pa-4"},{default:u(()=>[t(je,{flat:"",class:"mb-6",rounded:"lg"},{default:u(()=>[t(Oe,null,{default:u(()=>[t(Ue,{ref_key:"form",ref:g,modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=r=>b.value=r),"fast-fail":"",onSubmit:ae(T,["prevent"]),class:"form-container"},{default:u(()=>[t(M,{dense:""},{default:u(()=>[t(B,{cols:"12",md:"6"},{default:u(()=>[t(h,{rules:[v.value.required,v.value.checkNo],modelValue:l.value.no,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.no=r),label:"编号",density:"compact",variant:"outlined",required:"",spellcheck:"false",disabled:p.value||e.viewOnly},null,8,["rules","modelValue","disabled"]),t(h,{rules:[v.value.required],modelValue:l.value.name,"onUpdate:modelValue":a[1]||(a[1]=r=>l.value.name=r),label:"名称",density:"compact",variant:"outlined",required:"",spellcheck:"false",disabled:e.viewOnly},null,8,["rules","modelValue","disabled"]),t(h,{rules:[v.value.required,v.value.validJdbcUrl],modelValue:l.value.url,"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.url=r),label:"JDBC 地址",density:"compact",variant:"outlined",required:"",spellcheck:"false","append-inner-icon":f.value,disabled:e.viewOnly},null,8,["rules","modelValue","append-inner-icon","disabled"])]),_:1}),t(B,{cols:"12",md:"6"},{default:u(()=>[t(h,{rules:[v.value.required],modelValue:l.value.username,"onUpdate:modelValue":a[3]||(a[3]=r=>l.value.username=r),label:"用户名",density:"compact",variant:"outlined",required:"",spellcheck:"false",disabled:e.viewOnly},null,8,["rules","modelValue","disabled"]),t(h,{modelValue:l.value.password,"onUpdate:modelValue":a[4]||(a[4]=r=>l.value.password=r),label:"密码",density:"compact",variant:"outlined","append-icon":y.value?"mdi-eye":"mdi-eye-off",type:y.value?"text":"password","onClick:append":a[5]||(a[5]=r=>y.value=!y.value),disabled:e.viewOnly},null,8,["modelValue","append-icon","type","disabled"]),t(qe,{rules:[v.value.required],modelValue:l.value.driver,"onUpdate:modelValue":a[6]||(a[6]=r=>l.value.driver=r),label:"驱动类",items:P.value,density:"compact",variant:"outlined",required:"",disabled:e.viewOnly},null,8,["rules","modelValue","items","disabled"])]),_:1})]),_:1}),t(M,{class:"mt-4"},{default:u(()=>[t(B,{cols:"12"},{default:u(()=>[I("div",Re,[e.viewOnly?(D(),A("div",Ae)):(D(),F(U,{key:0,color:"primary",variant:"text",size:"small","prepend-icon":"mdi-connection",onClick:j,loading:S.value},{default:u(()=>[...a[8]||(a[8]=[q(" 测试连接 ",-1)])]),_:1},8,["loading"])),I("div",Ie,[t(U,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-close",onClick:C},{default:u(()=>[q(Y(e.viewOnly?"关闭":"取消"),1)]),_:1}),e.viewOnly?te("",!0):(D(),F(U,{key:0,type:"submit",disabled:!b.value,color:"primary",variant:"elevated",size:"small","prepend-icon":"mdi-content-save",loading:V.value},{default:u(()=>[...a[9]||(a[9]=[q(" 保存 ",-1)])]),_:1},8,["disabled","loading"]))])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]))}}),_e=be($e,[["__scopeId","data-v-ea0990a8"]]);export{_e as D,Fe as _};
